# 講義コメント分析システム

AWS Bedrock Claude Instantを使用した講義コメントの自動分析システム

## 要件定義・設計

### 問題設計
- **課題**: 大量の講義コメントを手動で分析・分類する作業の効率化
- **解決方針**: AI（LLM）による自動分析で感情・カテゴリ・危険度を判定
- **設計思想**: ルールベースを廃止し、全てLLMに委ねることで分析精度を向上

### 成功指標の定義
- **主要指標**: 分析精度（危険コメント・感情分類の自然な判定）
- **判定基準**: 人間の目から見て自然に分類されているかの主観評価
- **非機能要件**: 今回は速度要件なし、精度最優先とした

### AI性能計測
- **評価データ**: 実際の講義コメントデータを使用
- **計測方法**: 危険コメント・ポジティブ/ネガティブ分類の妥当性を目視確認
- **改善手法**: プロンプトエンジニアリングによる判定基準の詳細化

## アーキテクチャ

### システム構成
```
[フロントエンド]
    ↓ 
[Lambda Function URLs] ← API Gateway廃止
    ↓
[AWS Lambda] ← EC2使用不可のためLambda選択
    ↓
[AWS Bedrock Claude Instant] ← Hugging Face制限回避
    ↓
[S3バケット] (ジョブ管理・ウェブホスティング)
```

### 技術選定理由

**Lambda Function URLs採用**
- API Gatewayの29秒タイムアウト制限を回避
- EC2が使用不可のため、Lambdaを選択
- 大量データ処理のため非同期処理アーキテクチャを構築

**AWS Bedrock Claude Instant選択**
- Hugging Face無料版のRate Limit制限を回避
- 日本語対応の高精度分析が可能
- AWS環境での安定した推論性能

**非同期処理設計**
- S3バケットでジョブ状態管理
- UUID基盤のジョブ追跡システム

### データフロー
1. フロントエンドでExcelファイルアップロード
2. Lambda関数でファイル解析・S3一時保存
3. バッチ処理でBedrock API呼び出し
4. 結果をS3に保存・進捗更新
5. フロントエンドでリアルタイム進捗表示
6. 分析完了後、結果表示・CSV出力

### 非同期処理の仕組み
**目的**: ブラウザフリーズ回避

**問題**: 
- 1000件処理には5-15分かかる
- Lambda Function URLsは15分対応だが、ブラウザ側で長時間HTTPリクエストを維持するのは困難
- ブラウザのタイムアウト（通常2-5分）、ネットワーク切断、ユーザーのタブ操作等でリクエストが中断される
- 同期処理では処理中断時に結果を失う

**解決方法**:
1. **ジョブ開始**: UUIDでジョブ作成、S3に状態保存、即座にジョブIDを返却
2. **バックグラウンド処理**: Lambda関数内で分析実行
3. **進捗更新**: 処理中にS3のジョブ情報を随時更新
4. **フロントエンドポーリング**: 10秒間隔でジョブ状況をチェック
5. **完了通知**: status='completed'で結果取得・表示

**効果**: ユーザーはブラウザを自由に操作でき、処理が中断されても結果を取得可能

## 開発・実装・検証

### モデル選定プロセス
1. **Hugging Face無料版**: Rate Limit制限で断念
2. **AWS Bedrock Claude Instant**: 日本語対応・高精度・安定性で採用
3. **プロンプト設計**: 講義運営観点での危険度判定基準を詳細化

### 評価データ選定
- 実際の講義コメントデータを使用
- テストモード（100件制限）で開発・検証
- 危険コメント検出精度の向上を重視

### アプリケーション構築
**フロントエンド**
- HTML/JavaScript/CSS（シングルページアプリケーション）
- リアルタイム進捗バー（10秒ポーリング）
- 同期/非同期処理モード選択
- CSV出力機能

**バックエンド**
- Python 3.9（AWS Lambda）
- openpyxl（Excel処理）
- boto3（AWS SDK）

### CI/CD環境
**当初計画**: GitHub Actions自動デプロイ
**実装結果**: 手動デプロイに変更

**変更理由**:
- AWS Student権限でIAMユーザー作成不可
- 現状のアクセスキーででCI/CD認証エラー
- 権限制約により自動化を断念

**現在の運用**: `./deploy.sh`による手動デプロイ

### プロジェクトマネジメント
- 段階的開発（同期→非同期処理への移行）

## 技術仕様

### デプロイ方法
```bash
./deploy.sh
```

## 成果と課題

### 成果
- LLM活用による高精度な自動分析システム構築
- 大量データ処理対応の非同期アーキテクチャ実現
- AWS制約下での最適なサービス選択・組み合わせ

### 技術的課題と解決
- **API Gateway制限**: Lambda Function URLsで解決
- **処理時間制約**: 非同期処理で解決
- **Lambda実行時間制限**: 15分制限のため大量データ処理に制約
- **権限制約**: 手動デプロイで運用

### 今後の改善点
- CI/CD環境の構築（適切な権限取得後）
- Lambda制限を超える大量データ処理への対応
- 処理速度の最適化
- 分析精度のさらなる向上 